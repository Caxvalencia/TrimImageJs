!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var a in r)("object"==typeof exports?exports:t)[a]=r[a]}}(window,function(){return function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";var a;r.r(e),function(t){t.TOP="TOP",t.RIGHT="RIGHT",t.BOTTOM="BOTTOM",t.LEFT="LEFT"}(a||(a={}));var n=function(){function t(){}return t.create=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r},t.context=function(e,r){return t.create(e,r).getContext("2d")},t}(),i=function(){function t(){}return t.getImageData=function(t){var e=t.width,r=t.height,a=n.context(e,r);return a.drawImage(t,0,0,e,r),a.getImageData(0,0,e,r)},t.create=function(t,e){return n.context(t,e).createImageData(t,e)},t}(),o=function(t,e,r,a){return new(r||(r=Promise))(function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function u(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(o,u)}c((a=a.apply(t,e||[])).next())})},u=function(t,e){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},c=function(){function t(t,e){this.configureImage(t,e)}return t.prototype.configureImage=function(t,e){return o(this,void 0,void 0,function(){var r,a;return u(this,function(n){switch(n.label){case 0:return r=this,"string"!=typeof t?[3,2]:[4,(i=t,new Promise(function(t,e){var r=new Image;r.onload=function(){return t(r)},r.onerror=e,r.src=i}))];case 1:return a=n.sent(),[3,3];case 2:a=t,n.label=3;case 3:return r.image=a,void 0!==e&&e.call(this,this.image),[2]}var i})})},t.prototype.getImage=function(t,e){this.validateImageData(t);var r=t.width,a=t.height,i=n.create(r,a);i.getContext("2d").putImageData(t,0,0);var o=new Image;return o.width=r,o.height=a,e&&(o.onload=e),o.src=i.toDataURL("image/png"),o},t.trim=function(e,r){return new t(e,r).trim()},t.trimTop=function(e,r){return new t(e,r).trimTop()},t.trimBottom=function(e,r){return new t(e,r).trimBottom()},t.trimLeft=function(e,r){return new t(e,r).trimLeft()},t.trimRight=function(e,r){return new t(e,r).trimRight()},t.prototype.trim=function(){return this.image=this.getImage(this._trim(i.getImageData(this.image))),this},t.prototype.trimTop=function(){return this.image=this.getImage(this._trimTop(i.getImageData(this.image))),this},t.prototype.trimBottom=function(){return this.image=this.getImage(this._trimBottom(i.getImageData(this.image))),this},t.prototype.trimLeft=function(){return this.image=this.getImage(this._trimLeft(i.getImageData(this.image))),this},t.prototype.trimRight=function(){return this.image=this.getImage(this._trimRight(i.getImageData(this.image))),this},t.prototype._trim=function(t){this.validateImageData(t);var e=this._trimTop(t);return e=this._trimBottom(e),e=this._trimLeft(e),e=this._trimRight(e)},t.prototype._trimTop=function(t){var e=0,r=4*t.width,n=t.height;return this.readImageData(a.TOP,t,function(t,r,a){if(0!=a.alpha())return e=t,"break"}),this.cutImageData(t,e,0,n,r)},t.prototype._trimBottom=function(t){var e=t.height,r=4*t.width;return this.readImageData(a.BOTTOM,t,function(t,r,a){if(0!=a.alpha())return e=t,"break"}),this.cutImageData(t,0,0,e,r)},t.prototype._trimLeft=function(t){var e=0,r=4*t.width,n=t.height;return this.readImageData(a.LEFT,t,function(t,r,a){if(0!=a.alpha())return e=r,"break"}),this.cutImageData(t,0,e,n,r)},t.prototype._trimRight=function(t){var e=4*t.width,r=t.height;return this.readImageData(a.RIGHT,t,function(t,r,a){if(0!=a.alpha())return e=r,"break"}),this.cutImageData(t,0,0,r,e)},t.prototype.cutImageData=function(t,e,r,a,n){this.validateImageData(t);var o=t.data,u=4*t.width;a=0==a?1:a,n=0==n?1:n;for(var c=a==e?1:a-e,f=n/4-r/4,h=i.create(f,c),s=u-n,m=0,g=e;g<a;g++)for(var p=g*n+g*s,l=r;l<n;l+=4,m+=4)h.data[m]=o[p+l],h.data[m+1]=o[p+l+1],h.data[m+2]=o[p+l+2],h.data[m+3]=o[p+l+3];return h},t.prototype.readImageData=function(t,e,r){this.validateImageData(e);var n,i,o=e.data,u=-1,c=4*e.width,f=e.height,h=!1;if(t===a.TOP){var s=f,m=0,g=c,p={row:1,col:4};for(n=l=0;n<s;n+=p.row){for(u=n*c,i=m;i<g&&"break"!=(h=r.apply(this,[n,i,{red:d(u+i),green:d(u+i+1),blue:d(u+i+2),alpha:d(u+i+3)}]));i+=p.col);if("break"==h)break}}else if(t===a.BOTTOM){s=0,m=c,g=0;for(n=l=f;n>=s;n--){for(u=n*m,i=m;i>g&&"break"!=(h=r.apply(this,[n,i,{red:d(u-i),green:d(u-i-3),blue:d(u-i-2),alpha:d(u-i-1)}]));i-=4);if("break"==h)break}}else if(t===a.LEFT){var l=0;s=f,g=c;for(i=m=0;i<g;i+=4){for(n=l;n<s&&(u=n*g,"break"!=(h=r.apply(this,[n,i,{red:d(u+i),green:d(u+i+1),blue:d(u+i+2),alpha:d(u+i+3)}])));n++);if("break"==h)break}}else if(t===a.RIGHT){l=f-1,s=1,g=0;for(i=m=c;i>g;i-=4){for(n=l;n>s&&(u=n*m-4+i,"break"!=(h=r.apply(this,[n,i,{red:d(u-3),green:d(u-2),blue:d(u-1),alpha:d(u)}])));n--);if("break"==h)break}}function d(t){return function(e){if(!e)return o[t];o[t]=e}}return e},t.prototype.validateImageData=function(t){if("imagedata"!==(e=t,{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()))throw"ImageData Exception: No es compatible el tipo de dato";var e},t}();r.d(e,"TrimImage",function(){return c})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvY29uc3RhbnRzL3R5cGUtcmVhZGVyLnRzIiwid2VicGFjazovLy8uL3NyYy9oZWxwZXJzL2NhbnZhcy5oZWxwZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2hlbHBlcnMvaW1hZ2UtZGF0YS5oZWxwZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyaW0taW1hZ2UudHMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwiYSIsImkiLCJ3aW5kb3ciLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlR5cGVSZWFkZXIiLCJDYW52YXNIZWxwZXIiLCJjcmVhdGUiLCJ3aWR0aCIsImhlaWdodCIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiaW1hZ2VfZGF0YV9oZWxwZXJfSW1hZ2VEYXRhSGVscGVyIiwiSW1hZ2VEYXRhSGVscGVyIiwiZ2V0SW1hZ2VEYXRhIiwiaW1hZ2UiLCJpbWdXaWR0aCIsImltZ0hlaWdodCIsImRyYXdJbWFnZSIsImNyZWF0ZUltYWdlRGF0YSIsInRyaW1faW1hZ2VfVHJpbUltYWdlIiwiVHJpbUltYWdlIiwiZnVuY0xvYWRCYWNrIiwidGhpcyIsImNvbmZpZ3VyZUltYWdlIiwiY2FsbGJhY2siLCJfYSIsInNyYyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbmVycm9yIiwiX2IiLCJfYyIsInNlbnQiLCJ1bmRlZmluZWQiLCJnZXRJbWFnZSIsImltYWdlRGF0YSIsImZ1bmNCYWNrIiwidmFsaWRhdGVJbWFnZURhdGEiLCJwdXRJbWFnZURhdGEiLCJ0b0RhdGFVUkwiLCJ0cmltIiwidHJpbVRvcCIsInRyaW1Cb3R0b20iLCJ0cmltTGVmdCIsInRyaW1SaWdodCIsIl90cmltIiwiX3RyaW1Ub3AiLCJfdHJpbUJvdHRvbSIsIl90cmltTGVmdCIsIl90cmltUmlnaHQiLCJ0cmltbWVkSW1hZ2UiLCJyb3ciLCJsZW5naHRDb2wiLCJsZW5naHRSb3ciLCJyZWFkSW1hZ2VEYXRhIiwiVE9QIiwiX3JvdyIsIl9jb2wiLCJyZ2JhIiwiYWxwaGEiLCJjdXRJbWFnZURhdGEiLCJCT1RUT00iLCJjb2x1bW4iLCJMRUZUIiwibGVuX2NvbCIsImxlbl9yb3ciLCJSSUdIVCIsInJvd0luaSIsImNvbEluaSIsInJvd0ZpbiIsImNvbEZpbiIsInBpeGVscyIsImRhdGEiLCJjb3B5SGVpZ2h0IiwiY29weVdpZHRoIiwiY29weUltYWdlRGF0YSIsImRpZmZDb2wiLCJjb3VudENvcHkiLCJyb3dDdXJyZW50IiwiY29sIiwidHlwZVJlYWRlciIsImlzQnJlYWsiLCJpbnRlcmF0b3IiLCJhcHBseSIsInJlZCIsImdldEFuZFNldEZvclBpeGVsIiwiZ3JlZW4iLCJibHVlIiwicG9zIiwidmFsIiwiZWxlbWVudCIsInRvU3RyaW5nIiwibWF0Y2giLCJ0b0xvd2VyQ2FzZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxvQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsU0FDQSxzQkFBQUcsZUFBQUMsSUFDQUQsVUFBQUgsT0FDQSxDQUNBLElBQUFLLEVBQUFMLElBQ0EsUUFBQU0sS0FBQUQs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RUFBUytDLE1BQU1qRSxNQUNyQmlDLEVBQ0E0QixHQUVJSyxJQUFLQyxFQUFrQlAsRUFBYSxHQUNwQ1EsTUFBT0QsRUFBa0JQLEVBQWEsR0FDdENTLEtBQU1GLEVBQWtCUCxFQUFhLEdBQ3JDbkIsTUFBTzBCLEVBQWtCUCxRQVZKM0IsS0FtQmpDLEdBQWUsU0FBWDhCLEVBQ0EsT0FLWixTQUFBSSxFQUEyQkcsR0FDdkIsT0FBTyxTQUFTQyxHQUNaLElBQUtBLEVBQ0QsT0FBT2xCLEVBQU9pQixHQUdsQmpCLEVBQU9pQixHQUFPQyxHQUl0QixPQUFPdEQsR0FNSG5CLEVBQUF2QixVQUFBNEMsa0JBQVIsU0FBMEJGLEdBQ3RCLEdBQXNCLGVBS2xCdUQsRUFMR3ZELEtBTUR3RCxTQUNMcEgsS0FBS21ILEdBQ0xFLE1BQU0sa0JBQWtCLEdBQ3hCQyxlQVJHLEtBQU0sd0RBSWxCLElBQVlILEdBRloxRSxFQXZlQSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2Uge1xuXHRcdHZhciBhID0gZmFjdG9yeSgpO1xuXHRcdGZvcih2YXIgaSBpbiBhKSAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZXhwb3J0cyA6IHJvb3QpW2ldID0gYVtpXTtcblx0fVxufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGVudW0gVHlwZVJlYWRlciB7XG4gICAgVE9QID0gJ1RPUCcsXG4gICAgUklHSFQgPSAnUklHSFQnLFxuICAgIEJPVFRPTSA9ICdCT1RUT00nLFxuICAgIExFRlQgPSAnTEVGVCdcbn1cbiIsImV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDYW52YXNIZWxwZXIge1xuICAgIC8qKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGhcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0XG4gICAgICogQHJldHVybnMge0hUTUxDYW52YXNFbGVtZW50fVxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVhdGUod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBIVE1MQ2FudmFzRWxlbWVudCB7XG4gICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgICAgICAgcmV0dXJuIGNhbnZhcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodFxuICAgICAqIEByZXR1cm5zIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9XG4gICAgICovXG4gICAgc3RhdGljIGNvbnRleHQod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQge1xuICAgICAgICByZXR1cm4gQ2FudmFzSGVscGVyLmNyZWF0ZSh3aWR0aCwgaGVpZ2h0KS5nZXRDb250ZXh0KCcyZCcpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENhbnZhc0hlbHBlciB9IGZyb20gJy4vY2FudmFzLmhlbHBlcic7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBJbWFnZURhdGFIZWxwZXIge1xuICAgIC8qKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnR9IGltYWdlXG4gICAgICogQHJldHVybnMge0ltYWdlRGF0YX1cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0SW1hZ2VEYXRhKGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50KTogSW1hZ2VEYXRhIHtcbiAgICAgICAgbGV0IGltZ1dpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICAgIGxldCBpbWdIZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XG5cbiAgICAgICAgbGV0IGNvbnRleHQgPSBDYW52YXNIZWxwZXIuY29udGV4dChpbWdXaWR0aCwgaW1nSGVpZ2h0KTtcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGltZ1dpZHRoLCBpbWdIZWlnaHQpO1xuXG4gICAgICAgIHJldHVybiBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgXG4gICAgICogQHJldHVybnMge0ltYWdlRGF0YX0gXG4gICAgICovXG4gICAgc3RhdGljIGNyZWF0ZSh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEltYWdlRGF0YSB7XG4gICAgICAgIHJldHVybiBDYW52YXNIZWxwZXIuY29udGV4dCh3aWR0aCwgaGVpZ2h0KS5jcmVhdGVJbWFnZURhdGEoXG4gICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodFxuICAgICAgICApO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IFR5cGVSZWFkZXIgfSBmcm9tICcuL2NvbnN0YW50cy90eXBlLXJlYWRlcic7XG5pbXBvcnQgeyBDb2xvclJHQkEgfSBmcm9tICcuL2NvbnRyYWN0cy9jb2xvci1yZ2JhJztcbmltcG9ydCB7IEltYWdlRGF0YUhlbHBlciB9IGZyb20gJy4vaGVscGVycy9pbWFnZS1kYXRhLmhlbHBlcic7XG5pbXBvcnQgeyBDYW52YXNIZWxwZXIgfSBmcm9tICcuL2hlbHBlcnMvY2FudmFzLmhlbHBlcic7XG5cbi8qKlxuICogQGV4cG9ydFxuICogQGNsYXNzIFRyaW1JbWFnZVxuICovXG5leHBvcnQgY2xhc3MgVHJpbUltYWdlIHtcbiAgICBwcml2YXRlIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBUcmltSW1hZ2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnR9IGltYWdlIEltYWdlbiBhIHByb2Nlc2FyXG4gICAgICogQHBhcmFtIHthbnl9IGZ1bmNMb2FkQmFjayBGdW5jacOzbiBiYWNrIHBhcmEgZWwgbG9hZCBkZSBsYSBpbWFnZW5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpbWFnZTogSFRNTEltYWdlRWxlbWVudCwgZnVuY0xvYWRCYWNrKSB7XG4gICAgICAgIHRoaXMuY29uZmlndXJlSW1hZ2UoaW1hZ2UsIGZ1bmNMb2FkQmFjayk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gQ29uZmlndXJhIGVsIHBhcmFtZXRybyBkZSBlbnRyYWRhIFwiaW1hZ2VcIiBkZWwgY29uc3RydWN0b3JcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7W2ltYWdlIG9iamVjdCwgU3RyaW5nXX0gaW1hZ2UgLSBJbWFnZW4gYSB0cmF0YXJcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEZ1bmNpb24gY2FsbGJhY2tcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge2ltYWdlRGF0YSBvYmplY3R9XG4gICAgICovXG4gICAgYXN5bmMgY29uZmlndXJlSW1hZ2UoaW1hZ2U6IHN0cmluZyB8IEhUTUxJbWFnZUVsZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuaW1hZ2UgPVxuICAgICAgICAgICAgdHlwZW9mIGltYWdlID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgID8gYXdhaXQgY3JlYXRlSW1hZ2UoaW1hZ2UpXG4gICAgICAgICAgICAgICAgOiA8SFRNTEltYWdlRWxlbWVudD5pbWFnZTtcblxuICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCB0aGlzLmltYWdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIENvbnZpZXJ0ZSB1biBpbWFnZURhdGEgb2JqZWN0IGEgdW4gaW1hZ2Ugb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltYWdlRGF0YX0gaW1hZ2VEYXRhIC0gT2JqZXRvIGNvbiBtYXRyaXogZGUgZGF0b3MgZGUgbGEgaW1hZ2VuXG4gICAgICogQHJldHVybiB7SFRNTEltYWdlRWxlbWVudH1cbiAgICAgKi9cbiAgICBnZXRJbWFnZShpbWFnZURhdGEsIGZ1bmNCYWNrPykge1xuICAgICAgICB0aGlzLnZhbGlkYXRlSW1hZ2VEYXRhKGltYWdlRGF0YSk7XG5cbiAgICAgICAgbGV0IGltZ1dpZHRoID0gaW1hZ2VEYXRhLndpZHRoO1xuICAgICAgICBsZXQgaW1nSGVpZ2h0ID0gaW1hZ2VEYXRhLmhlaWdodDtcblxuICAgICAgICBsZXQgY2FudmFzID0gQ2FudmFzSGVscGVyLmNyZWF0ZShpbWdXaWR0aCwgaW1nSGVpZ2h0KTtcbiAgICAgICAgbGV0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApO1xuXG4gICAgICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWFnZS53aWR0aCA9IGltZ1dpZHRoO1xuICAgICAgICBpbWFnZS5oZWlnaHQgPSBpbWdIZWlnaHQ7XG5cbiAgICAgICAgaWYgKGZ1bmNCYWNrKSB7XG4gICAgICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jQmFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIGltYWdlLnNyYyA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpO1xuXG4gICAgICAgIHJldHVybiBpbWFnZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHBhcmFtIHthbnl9IFtpbWFnZV1cbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tdXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBzdGF0aWMgdHJpbShpbWFnZT8sIGNhbGxiYWNrPykge1xuICAgICAgICByZXR1cm4gbmV3IFRyaW1JbWFnZShpbWFnZSwgY2FsbGJhY2spLnRyaW0oKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgdHJpbVRvcChpbWFnZT8sIGNhbGxiYWNrPykge1xuICAgICAgICByZXR1cm4gbmV3IFRyaW1JbWFnZShpbWFnZSwgY2FsbGJhY2spLnRyaW1Ub3AoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgdHJpbUJvdHRvbShpbWFnZT8sIGNhbGxiYWNrPykge1xuICAgICAgICByZXR1cm4gbmV3IFRyaW1JbWFnZShpbWFnZSwgY2FsbGJhY2spLnRyaW1Cb3R0b20oKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgdHJpbUxlZnQoaW1hZ2U/LCBjYWxsYmFjaz8pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUcmltSW1hZ2UoaW1hZ2UsIGNhbGxiYWNrKS50cmltTGVmdCgpO1xuICAgIH1cblxuICAgIHN0YXRpYyB0cmltUmlnaHQoaW1hZ2U/LCBjYWxsYmFjaz8pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUcmltSW1hZ2UoaW1hZ2UsIGNhbGxiYWNrKS50cmltUmlnaHQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBFbGltaW5hIHBpeGVsZXMgaW5uZWNlc2FyaW9zIHBhcmEgdG9kb3MgbG9zIGJvcmRlcyBkZSBsYSBpbWFnZW5cbiAgICAgKi9cbiAgICB0cmltKCkge1xuICAgICAgICB0aGlzLmltYWdlID0gdGhpcy5nZXRJbWFnZShcbiAgICAgICAgICAgIHRoaXMuX3RyaW0oSW1hZ2VEYXRhSGVscGVyLmdldEltYWdlRGF0YSh0aGlzLmltYWdlKSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBFbGltaW5hIHBpeGVsZXMgaW5uZWNlc2FyaW9zIHBhcmEgZWwgYm9yZGUgc3VwZXJpb3IgZGUgbGEgaW1hZ2VuXG4gICAgICogQHBhcmFtIFtpbWFnZSBvYmplY3RdIGltYWdlIC0gUGFyYW1ldHJvIG9wY2lvbmFsIHRpcG8gSW1hZ2VcbiAgICAgKiBAcmV0dXJuIFtpbWFnZSBvYmplY3QsIHRoaXNdIC0gUmV0b3JuYSB0aGlzIHNpIGVsIHBhcmFtZXRybyBlcyBpbmRlZmluaWRvXG4gICAgICovXG4gICAgdHJpbVRvcCgpIHtcbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLl90cmltVG9wKEltYWdlRGF0YUhlbHBlci5nZXRJbWFnZURhdGEodGhpcy5pbWFnZSkpXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gRWxpbWluYSBwaXhlbGVzIGlubmVjZXNhcmlvcyBwYXJhIGVsIGJvcmRlIGluZmVyaW9yIGRlIGxhIGltYWdlblxuICAgICAqIEBwYXJhbSBbaW1hZ2Ugb2JqZWN0XSBpbWFnZSAtIFBhcmFtZXRybyBvcGNpb25hbCB0aXBvIEltYWdlXG4gICAgICogQHJldHVybiBbaW1hZ2Ugb2JqZWN0LCB0aGlzXSAtIFJldG9ybmEgdGhpcyBzaSBlbCBwYXJhbWV0cm8gZXMgaW5kZWZpbmlkb1xuICAgICAqL1xuICAgIHRyaW1Cb3R0b20oKSB7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLmdldEltYWdlKFxuICAgICAgICAgICAgdGhpcy5fdHJpbUJvdHRvbShJbWFnZURhdGFIZWxwZXIuZ2V0SW1hZ2VEYXRhKHRoaXMuaW1hZ2UpKVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBpbm5lY2VzYXJpb3MgcGFyYSBlbCBib3JkZSBpenF1aWVyZG8gZGUgbGEgaW1hZ2VuXG4gICAgICogQHBhcmFtIFtpbWFnZSBvYmplY3RdIGltYWdlIC0gUGFyYW1ldHJvIG9wY2lvbmFsIHRpcG8gSW1hZ2VcbiAgICAgKiBAcmV0dXJuIFtpbWFnZSBvYmplY3QsIHRoaXNdIC0gUmV0b3JuYSB0aGlzIHNpIGVsIHBhcmFtZXRybyBlcyBpbmRlZmluaWRvXG4gICAgICovXG4gICAgdHJpbUxlZnQoKSB7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLmdldEltYWdlKFxuICAgICAgICAgICAgdGhpcy5fdHJpbUxlZnQoSW1hZ2VEYXRhSGVscGVyLmdldEltYWdlRGF0YSh0aGlzLmltYWdlKSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBFbGltaW5hIHBpeGVsZXMgaW5uZWNlc2FyaW9zIHBhcmEgZWwgYm9yZGUgZGVyZWNobyBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcmV0dXJucyB7dGhpc31cbiAgICAgKi9cbiAgICB0cmltUmlnaHQoKTogdGhpcyB7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLmdldEltYWdlKFxuICAgICAgICAgICAgdGhpcy5fdHJpbVJpZ2h0KEltYWdlRGF0YUhlbHBlci5nZXRJbWFnZURhdGEodGhpcy5pbWFnZSkpXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gRWxpbWluYSBwaXhlbGVzIGRlIGxhIGltYWdlbiBpbm5lY2VzYXJpb3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7SW1hZ2VEYXRhfSBpbWFnZURhdGFcbiAgICAgKiBAcmV0dXJucyB7SW1hZ2VEYXRhfVxuICAgICAqL1xuICAgIHByaXZhdGUgX3RyaW0oaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xuICAgICAgICB0aGlzLnZhbGlkYXRlSW1hZ2VEYXRhKGltYWdlRGF0YSk7XG5cbiAgICAgICAgbGV0IHRyaW1tZWRJbWFnZSA9IHRoaXMuX3RyaW1Ub3AoaW1hZ2VEYXRhKTtcbiAgICAgICAgdHJpbW1lZEltYWdlID0gdGhpcy5fdHJpbUJvdHRvbSh0cmltbWVkSW1hZ2UpO1xuICAgICAgICB0cmltbWVkSW1hZ2UgPSB0aGlzLl90cmltTGVmdCh0cmltbWVkSW1hZ2UpO1xuICAgICAgICB0cmltbWVkSW1hZ2UgPSB0aGlzLl90cmltUmlnaHQodHJpbW1lZEltYWdlKTtcblxuICAgICAgICByZXR1cm4gdHJpbW1lZEltYWdlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YVxuICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9XG4gICAgICovXG4gICAgcHJpdmF0ZSBfdHJpbVRvcChpbWFnZURhdGE6IEltYWdlRGF0YSk6IEltYWdlRGF0YSB7XG4gICAgICAgIGxldCByb3cgPSAwO1xuICAgICAgICBsZXQgbGVuZ2h0Q29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcbiAgICAgICAgbGV0IGxlbmdodFJvdyA9IGltYWdlRGF0YS5oZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5yZWFkSW1hZ2VEYXRhKFxuICAgICAgICAgICAgVHlwZVJlYWRlci5UT1AsXG4gICAgICAgICAgICBpbWFnZURhdGEsXG4gICAgICAgICAgICAoX3JvdywgX2NvbCwgcmdiYTogQ29sb3JSR0JBKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJnYmEuYWxwaGEoKSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvdyA9IF9yb3c7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdicmVhayc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmN1dEltYWdlRGF0YShpbWFnZURhdGEsIHJvdywgMCwgbGVuZ2h0Um93LCBsZW5naHRDb2wpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YVxuICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9XG4gICAgICovXG4gICAgcHJpdmF0ZSBfdHJpbUJvdHRvbShpbWFnZURhdGE6IEltYWdlRGF0YSk6IEltYWdlRGF0YSB7XG4gICAgICAgIGxldCBsZW5naHRSb3cgPSBpbWFnZURhdGEuaGVpZ2h0O1xuICAgICAgICBsZXQgbGVuZ2h0Q29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcblxuICAgICAgICB0aGlzLnJlYWRJbWFnZURhdGEoXG4gICAgICAgICAgICBUeXBlUmVhZGVyLkJPVFRPTSxcbiAgICAgICAgICAgIGltYWdlRGF0YSxcbiAgICAgICAgICAgIChfcm93LCBfY29sLCByZ2JhOiBDb2xvclJHQkEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmdiYS5hbHBoYSgpICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbGVuZ2h0Um93ID0gX3JvdztcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2JyZWFrJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3V0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCwgbGVuZ2h0Um93LCBsZW5naHRDb2wpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YVxuICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9XG4gICAgICovXG4gICAgcHJpdmF0ZSBfdHJpbUxlZnQoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xuICAgICAgICBsZXQgY29sdW1uID0gMDtcbiAgICAgICAgbGV0IGxlbmdodENvbCA9IGltYWdlRGF0YS53aWR0aCAqIDQ7XG4gICAgICAgIGxldCBsZW5naHRSb3cgPSBpbWFnZURhdGEuaGVpZ2h0O1xuXG4gICAgICAgIHRoaXMucmVhZEltYWdlRGF0YShcbiAgICAgICAgICAgIFR5cGVSZWFkZXIuTEVGVCxcbiAgICAgICAgICAgIGltYWdlRGF0YSxcbiAgICAgICAgICAgIChfcm93LCBfY29sLCByZ2JhOiBDb2xvclJHQkEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmdiYS5hbHBoYSgpICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uID0gX2NvbDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2JyZWFrJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3V0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgY29sdW1uLCBsZW5naHRSb3csIGxlbmdodENvbCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0ltYWdlRGF0YX0gaW1hZ2VEYXRhXG4gICAgICogQHJldHVybnMge0ltYWdlRGF0YX1cbiAgICAgKi9cbiAgICBwcml2YXRlIF90cmltUmlnaHQoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xuICAgICAgICBsZXQgbGVuX2NvbCA9IGltYWdlRGF0YS53aWR0aCAqIDQ7XG4gICAgICAgIGxldCBsZW5fcm93ID0gaW1hZ2VEYXRhLmhlaWdodDtcblxuICAgICAgICB0aGlzLnJlYWRJbWFnZURhdGEoXG4gICAgICAgICAgICBUeXBlUmVhZGVyLlJJR0hULFxuICAgICAgICAgICAgaW1hZ2VEYXRhLFxuICAgICAgICAgICAgKF9yb3csIF9jb2wsIHJnYmE6IENvbG9yUkdCQSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZ2JhLmFscGhhKCkgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBsZW5fY29sID0gX2NvbDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2JyZWFrJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3V0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCwgbGVuX3JvdywgbGVuX2NvbCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3dJbmlcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gY29sSW5pXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHJvd0ZpblxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb2xGaW5cbiAgICAgKiBAcmV0dXJucyB7SW1hZ2VEYXRhfVxuICAgICAqL1xuICAgIGN1dEltYWdlRGF0YShcbiAgICAgICAgaW1hZ2VEYXRhOiBJbWFnZURhdGEsXG4gICAgICAgIHJvd0luaTogbnVtYmVyLFxuICAgICAgICBjb2xJbmk6IG51bWJlcixcbiAgICAgICAgcm93RmluOiBudW1iZXIsXG4gICAgICAgIGNvbEZpbjogbnVtYmVyXG4gICAgKTogSW1hZ2VEYXRhIHtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUltYWdlRGF0YShpbWFnZURhdGEpO1xuXG4gICAgICAgIGxldCBwaXhlbHMgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgICAgbGV0IGxlbl9jb2wgPSBpbWFnZURhdGEud2lkdGggKiA0O1xuXG4gICAgICAgIHJvd0ZpbiA9IHJvd0ZpbiA9PSAwID8gMSA6IHJvd0ZpbjtcbiAgICAgICAgY29sRmluID0gY29sRmluID09IDAgPyAxIDogY29sRmluO1xuXG4gICAgICAgIGxldCBjb3B5SGVpZ2h0ID0gcm93RmluID09IHJvd0luaSA/IDEgOiByb3dGaW4gLSByb3dJbmksXG4gICAgICAgICAgICBjb3B5V2lkdGggPSBjb2xGaW4gLyA0IC0gY29sSW5pIC8gNDtcblxuICAgICAgICBsZXQgY29weUltYWdlRGF0YTogSW1hZ2VEYXRhID0gSW1hZ2VEYXRhSGVscGVyLmNyZWF0ZShcbiAgICAgICAgICAgIGNvcHlXaWR0aCxcbiAgICAgICAgICAgIGNvcHlIZWlnaHRcbiAgICAgICAgKTtcblxuICAgICAgICBsZXQgZGlmZkNvbCA9IGxlbl9jb2wgLSBjb2xGaW47XG4gICAgICAgIGxldCBjb3VudENvcHkgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IHJvdyA9IHJvd0luaTsgcm93IDwgcm93RmluOyByb3crKykge1xuICAgICAgICAgICAgbGV0IHJvd0N1cnJlbnQgPSByb3cgKiBjb2xGaW4gKyByb3cgKiBkaWZmQ29sO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBjb2wgPSBjb2xJbmk7IGNvbCA8IGNvbEZpbjsgY29sICs9IDQsIGNvdW50Q29weSArPSA0KSB7XG4gICAgICAgICAgICAgICAgY29weUltYWdlRGF0YS5kYXRhW2NvdW50Q29weV0gPSBwaXhlbHNbcm93Q3VycmVudCArIGNvbF07XG4gICAgICAgICAgICAgICAgY29weUltYWdlRGF0YS5kYXRhW2NvdW50Q29weSArIDFdID1cbiAgICAgICAgICAgICAgICAgICAgcGl4ZWxzW3Jvd0N1cnJlbnQgKyBjb2wgKyAxXTtcbiAgICAgICAgICAgICAgICBjb3B5SW1hZ2VEYXRhLmRhdGFbY291bnRDb3B5ICsgMl0gPVxuICAgICAgICAgICAgICAgICAgICBwaXhlbHNbcm93Q3VycmVudCArIGNvbCArIDJdO1xuICAgICAgICAgICAgICAgIGNvcHlJbWFnZURhdGEuZGF0YVtjb3VudENvcHkgKyAzXSA9XG4gICAgICAgICAgICAgICAgICAgIHBpeGVsc1tyb3dDdXJyZW50ICsgY29sICsgM107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29weUltYWdlRGF0YTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7VHlwZVJlYWRlcn0gdHlwZVJlYWRlclxuICAgICAqIEBwYXJhbSB7SW1hZ2VEYXRhfSBpbWFnZURhdGFcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jQmFja1xuICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkSW1hZ2VEYXRhKFxuICAgICAgICB0eXBlUmVhZGVyOiBUeXBlUmVhZGVyLFxuICAgICAgICBpbWFnZURhdGE6IEltYWdlRGF0YSxcbiAgICAgICAgZnVuY0JhY2tcbiAgICApOiBJbWFnZURhdGEge1xuICAgICAgICB0aGlzLnZhbGlkYXRlSW1hZ2VEYXRhKGltYWdlRGF0YSk7XG5cbiAgICAgICAgbGV0IHBpeGVscyA9IGltYWdlRGF0YS5kYXRhO1xuICAgICAgICBsZXQgcm93O1xuICAgICAgICBsZXQgY29sO1xuICAgICAgICBsZXQgcm93Q3VycmVudCA9IC0xO1xuXG4gICAgICAgIGxldCBsZW5fY29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcbiAgICAgICAgbGV0IGxlbl9yb3cgPSBpbWFnZURhdGEuaGVpZ2h0O1xuXG4gICAgICAgIGxldCBpc0JyZWFrOiBhbnkgPSBmYWxzZTtcblxuICAgICAgICBpZiAodHlwZVJlYWRlciA9PT0gVHlwZVJlYWRlci5UT1ApIHtcbiAgICAgICAgICAgIGxldCByb3dJbmkgPSAwO1xuICAgICAgICAgICAgbGV0IHJvd0ZpbiA9IGxlbl9yb3c7XG4gICAgICAgICAgICBsZXQgY29sSW5pID0gMDtcbiAgICAgICAgICAgIGxldCBjb2xGaW4gPSBsZW5fY29sO1xuXG4gICAgICAgICAgICBsZXQgaW50ZXJhdG9yID0ge1xuICAgICAgICAgICAgICAgIHJvdzogMSxcbiAgICAgICAgICAgICAgICBjb2w6IDRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZvciAocm93ID0gcm93SW5pOyByb3cgPCByb3dGaW47IHJvdyArPSBpbnRlcmF0b3Iucm93KSB7XG4gICAgICAgICAgICAgICAgcm93Q3VycmVudCA9IHJvdyAqIGxlbl9jb2w7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IGNvbEluaTsgY29sIDwgY29sRmluOyBjb2wgKz0gaW50ZXJhdG9yLmNvbCkge1xuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrID0gZnVuY0JhY2suYXBwbHkodGhpcywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgPENvbG9yUkdCQT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbjogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdWU6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgKyBjb2wgKyAyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0JyZWFrID09ICdicmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZVJlYWRlciA9PT0gVHlwZVJlYWRlci5CT1RUT00pIHtcbiAgICAgICAgICAgIGxldCByb3dJbmkgPSBsZW5fcm93O1xuICAgICAgICAgICAgbGV0IHJvd0ZpbiA9IDA7XG4gICAgICAgICAgICBsZXQgY29sSW5pID0gbGVuX2NvbDtcbiAgICAgICAgICAgIGxldCBjb2xGaW4gPSAwO1xuXG4gICAgICAgICAgICBmb3IgKHJvdyA9IHJvd0luaTsgcm93ID49IHJvd0Zpbjsgcm93LS0pIHtcbiAgICAgICAgICAgICAgICByb3dDdXJyZW50ID0gcm93ICogY29sSW5pO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb2wgPSBjb2xJbmk7IGNvbCA+IGNvbEZpbjsgY29sIC09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNCcmVhayA9IGZ1bmNCYWNrLmFwcGx5KHRoaXMsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxDb2xvclJHQkE+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZDogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIGNvbCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW46IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgLSBjb2wgLSAzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibHVlOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50IC0gY29sIC0gMiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgLSBjb2wgLSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNCcmVhayA9PSAnYnJlYWsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0JyZWFrID09ICdicmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVSZWFkZXIgPT09IFR5cGVSZWFkZXIuTEVGVCkge1xuICAgICAgICAgICAgbGV0IHJvd0luaSA9IDA7XG4gICAgICAgICAgICBsZXQgcm93RmluID0gbGVuX3JvdztcbiAgICAgICAgICAgIGxldCBjb2xJbmkgPSAwO1xuICAgICAgICAgICAgbGV0IGNvbEZpbiA9IGxlbl9jb2w7XG5cbiAgICAgICAgICAgIGZvciAoY29sID0gY29sSW5pOyBjb2wgPCBjb2xGaW47IGNvbCArPSA0KSB7XG4gICAgICAgICAgICAgICAgZm9yIChyb3cgPSByb3dJbmk7IHJvdyA8IHJvd0Zpbjsgcm93KyspIHtcbiAgICAgICAgICAgICAgICAgICAgcm93Q3VycmVudCA9IHJvdyAqIGNvbEZpbjtcblxuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrID0gZnVuY0JhY2suYXBwbHkodGhpcywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgPENvbG9yUkdCQT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbjogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdWU6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgKyBjb2wgKyAyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0JyZWFrID09ICdicmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZVJlYWRlciA9PT0gVHlwZVJlYWRlci5SSUdIVCkge1xuICAgICAgICAgICAgbGV0IHJvd0luaSA9IGxlbl9yb3cgLSAxO1xuICAgICAgICAgICAgbGV0IHJvd0ZpbiA9IDE7XG4gICAgICAgICAgICBsZXQgY29sSW5pID0gbGVuX2NvbDtcbiAgICAgICAgICAgIGxldCBjb2xGaW4gPSAwO1xuXG4gICAgICAgICAgICBmb3IgKGNvbCA9IGNvbEluaTsgY29sID4gY29sRmluOyBjb2wgLT0gNCkge1xuICAgICAgICAgICAgICAgIGZvciAocm93ID0gcm93SW5pOyByb3cgPiByb3dGaW47IHJvdy0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd0N1cnJlbnQgPSByb3cgKiBjb2xJbmkgLSA0ICsgY29sO1xuXG4gICAgICAgICAgICAgICAgICAgIGlzQnJlYWsgPSBmdW5jQmFjay5hcHBseSh0aGlzLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgICA8Q29sb3JSR0JBPntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWQ6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgLSAzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbjogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIDIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdWU6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgLSAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNCcmVhayA9PSAnYnJlYWsnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFuZFNldEZvclBpeGVsKHBvcykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgICAgIGlmICghdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwaXhlbHNbcG9zXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwaXhlbHNbcG9zXSA9IHZhbDtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW1hZ2VEYXRhO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBpbWFnZURhdGFcbiAgICAgKi9cbiAgICBwcml2YXRlIHZhbGlkYXRlSW1hZ2VEYXRhKGltYWdlRGF0YSkge1xuICAgICAgICBpZiAoaXMoaW1hZ2VEYXRhKSAhPT0gJ2ltYWdlZGF0YScpXG4gICAgICAgICAgICB0aHJvdyAnSW1hZ2VEYXRhIEV4Y2VwdGlvbjogTm8gZXMgY29tcGF0aWJsZSBlbCB0aXBvIGRlIGRhdG8nO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gaXMoZWxlbWVudCkge1xuICAgIHJldHVybiB7fS50b1N0cmluZ1xuICAgICAgICAuY2FsbChlbGVtZW50KVxuICAgICAgICAubWF0Y2goL1xccyhbYS16fEEtWl0rKS8pWzFdXG4gICAgICAgIC50b0xvd2VyQ2FzZSgpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBzcmNcbiAqIEByZXR1cm5zIHtQcm9taXNlPEhUTUxJbWFnZUVsZW1lbnQ+fVxuICovXG5mdW5jdGlvbiBjcmVhdGVJbWFnZShzcmM6IHN0cmluZyk6IFByb21pc2U8SFRNTEltYWdlRWxlbWVudD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHJlc29sdmUoaW1nKTtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSByZWplY3Q7XG4gICAgICAgIGltZy5zcmMgPSBzcmM7XG4gICAgfSk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9