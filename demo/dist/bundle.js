!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var a=e();for(var r in a)("object"==typeof exports?exports:t)[r]=a[r]}}(window,function(){return function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";var r;a.r(e),function(t){t.TOP="TOP",t.RIGHT="RIGHT",t.BOTTOM="BOTTOM",t.LEFT="LEFT"}(r||(r={}));var i=function(t,e,a,r){return new(a||(a=Promise))(function(i,n){function o(t){try{h(r.next(t))}catch(t){n(t)}}function u(t){try{h(r.throw(t))}catch(t){n(t)}}function h(t){t.done?i(t.value):new a(function(e){e(t.value)}).then(o,u)}h((r=r.apply(t,e||[])).next())})},n=function(t,e){var a,r,i,n,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function u(n){return function(u){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(i=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){o.label=n[1];break}if(6===n[0]&&o.label<i[1]){o.label=i[1],i=n;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(n);break}i[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,u])}}},o=function(){function t(t,e){this.configureImage(t,e)}return t.prototype.configureImage=function(t,e){return i(this,void 0,void 0,function(){var a,r;return n(this,function(i){switch(i.label){case 0:return a=this,"string"!=typeof t?[3,2]:[4,(n=t,new Promise(function(t,e){var a=new Image;a.onload=function(){return t(a)},a.onerror=e,a.src=n}))];case 1:return r=i.sent(),[3,3];case 2:r=t,i.label=3;case 3:return a.image=r,void 0!==e&&e.call(this,this.image),[2]}var n})})},t.prototype.getImageData=function(t){var e=t.width,a=t.height,r=u(e,a).context;return r.drawImage(t,0,0,e,a),r.getImageData(0,0,e,a)},t.prototype.getImage=function(t,e){this.validateImageData(t);var a=t.width,r=t.height,i=u(a,r),n=i.context,o=i.canvas;n.putImageData(t,0,0);var h=new Image;return h.width=a,h.height=r,e&&(h.onload=e),h.src=o.toDataURL("image/png"),h},t.trim=function(e,a){return new t(e,a).trim()},t.prototype.trim=function(t){return void 0!==t?this.getImage(this._trim(this.getImageData(t))):(this.image=this.getImage(this._trim(this.getImageData(this.image))),this)},t.prototype.trimTop=function(t){return void 0!==t?this.getImage(this._trimTop(this.getImageData(t))):(this.image=this.getImage(this._trimTop(this.getImageData(this.image))),this)},t.prototype.trimBottom=function(t){return void 0!==t?this.getImage(this._trimBottom(this.getImageData(t))):(this.image=this.getImage(this._trimBottom(this.getImageData(this.image))),this)},t.prototype.trimLeft=function(t){return void 0!==t?this.getImage(this._trimLeft(this.getImageData(t))):(this.image=this.getImage(this._trimLeft(this.getImageData(this.image))),this)},t.prototype.trimRight=function(t){return void 0!==t?this.getImage(this._trimRight(this.getImageData(t))):(this.image=this.getImage(this._trimRight(this.getImageData(this.image))),this)},t.prototype._trim=function(t){this.validateImageData(t);var e=this._trimTop(t);return e=this._trimBottom(e),e=this._trimLeft(e),e=this._trimRight(e)},t.prototype._trimTop=function(t){var e=0,a=4*t.width,i=t.height;return this.readImageData(r.TOP,t,function(t,a){if(0!=this.alpha())return e=t,"break"}),this.cutImageData(t,e,0,i,a)},t.prototype._trimBottom=function(t){var e=t.height,a=4*t.width;return this.readImageData(r.BOTTOM,t,function(t,a){if(0!=this.alpha())return e=t,"break"}),this.cutImageData(t,0,0,e,a)},t.prototype._trimLeft=function(t){var e=0,a=4*t.width,i=t.height;return this.readImageData(r.LEFT,t,function(t,a){if(0!=this.alpha())return e=a,"break"}),this.cutImageData(t,0,e,i,a)},t.prototype._trimRight=function(t){var e=4*t.width,a=t.height;return this.readImageData(r.RIGHT,t,function(t,a){if(0!=this.alpha())return e=a,"break"}),this.cutImageData(t,0,0,a,e)},t.prototype.cutImageData=function(t,e,a,r,i){this.validateImageData(t);var n=t.data,o=4*t.width;r=0==r?1:r,i=0==i?1:i;var h=r==e?1:r-e,s=i/4-a/4,c=[];u(s,h,function(t){c=t.createImageData(s,h)});for(var f=o-i,g=0,m=e;m<r;m++)for(var p=m*i+m*f,l=a;l<i;l+=4,g+=4)c.data[g]=n[p+l],c.data[g+1]=n[p+l+1],c.data[g+2]=n[p+l+2],c.data[g+3]=n[p+l+3];return c},t.prototype.readImageData=function(t,e,a){this.validateImageData(e);var i,n,o=e.data,u=-1,h=4*e.width,s=e.height,c=!1;if(t===r.TOP){var f=s,g=0,m=h,p={row:1,col:4};for(i=l=0;i<f;i+=p.row){for(u=i*h,n=g;n<m&&"break"!=(c=a.apply({red:d(u+n),green:d(u+n+1),blue:d(u+n+2),alpha:d(u+n+3)},[i,n]));n+=p.col);if("break"==c)break}}else if(t===r.BOTTOM){f=0,g=h,m=0;for(i=l=s;i>=f;i--){for(u=i*g,n=g;n>m&&"break"!=(c=a.apply({red:d(u-n),green:d(u-n-3),blue:d(u-n-2),alpha:d(u-n-1)},[i,n]));n-=4);if("break"==c)break}}else if(t===r.LEFT){var l=0;f=s,m=h;for(n=g=0;n<m;n+=4){for(i=l;i<f&&(u=i*m,"break"!=(c=a.apply({red:d(u+n),green:d(u+n+1),blue:d(u+n+2),alpha:d(u+n+3)},[i,n])));i++);if("break"==c)break}}else if(t===r.RIGHT){l=s-1,f=1,m=0;for(n=g=h;n>m;n-=4){for(i=l;i>f&&(u=i*g-4+n,"break"!=(c=a.apply({red:d(u-3),green:d(u-2),blue:d(u-1),alpha:d(u)},[i,n])));i--);if("break"==c)break}}function d(t){return function(e){if(!e)return o[t];o[t]=e}}return e},t.prototype.validateImageData=function(t){if("imagedata"!==(e=t,{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()))throw"ImageData Exception: No es compatible el tipo de dato";var e},t}();function u(t,e,a){var r=document.createElement("canvas");r.width=t,r.height=e;var i=r.getContext("2d"),n={canvas:r,context:i};return a&&a.apply(n,[i,r]),n}a.d(e,"TrimImage",function(){return o})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvY29uc3RhbnRzL3R5cGUtcmVhZGVyLnRzIiwid2VicGFjazovLy8uL3NyYy9UcmltSW1hZ2UudHMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwiYSIsImkiLCJ3aW5kb3ciLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlR5cGVSZWFkZXIiLCJUcmltSW1hZ2VfVHJpbUltYWdlIiwiVHJpbUltYWdlIiwiaW1hZ2UiLCJmdW5jTG9hZEJhY2siLCJ0aGlzIiwiY29uZmlndXJlSW1hZ2UiLCJjYWxsYmFjayIsIl9hIiwic3JjIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsIm9uZXJyb3IiLCJfYiIsIl9jIiwic2VudCIsInVuZGVmaW5lZCIsImdldEltYWdlRGF0YSIsImltZ1dpZHRoIiwid2lkdGgiLCJpbWdIZWlnaHQiLCJoZWlnaHQiLCJjb250ZXh0IiwiVHJpbUltYWdlX2NyZWF0ZUNhbnZhc0JhY2siLCJkcmF3SW1hZ2UiLCJnZXRJbWFnZSIsImltYWdlRGF0YSIsImZ1bmNCYWNrIiwidmFsaWRhdGVJbWFnZURhdGEiLCJjYW52YXNCYWNrIiwiY2FudmFzIiwicHV0SW1hZ2VEYXRhIiwidG9EYXRhVVJMIiwidHJpbSIsIl90cmltIiwidHJpbVRvcCIsIl90cmltVG9wIiwidHJpbUJvdHRvbSIsIl90cmltQm90dG9tIiwidHJpbUxlZnQiLCJfdHJpbUxlZnQiLCJ0cmltUmlnaHQiLCJfdHJpbVJpZ2h0IiwidHJpbW1lZEltYWdlIiwicm93IiwibGVuZ2h0Q29sIiwibGVuZ2h0Um93IiwicmVhZEltYWdlRGF0YSIsIlRPUCIsImFscGhhIiwiY3V0SW1hZ2VEYXRhIiwiQk9UVE9NIiwiY29sIiwiTEVGVCIsImxlbl9jb2wiLCJsZW5fcm93IiwiUklHSFQiLCJyb3dJbmkiLCJjb2xJbmkiLCJyb3dGaW4iLCJjb2xGaW4iLCJwaXhlbHMiLCJkYXRhIiwiY29weUhlaWdodCIsImNvcHlXaWR0aCIsImNvcHlJbWFnZURhdGEiLCJjdHgiLCJjcmVhdGVJbWFnZURhdGEiLCJkaWZmQ29sIiwiY291bnRDb3B5Iiwicm93Q3VycmVudCIsInR5cGVSZWFkZXIiLCJpc0JyZWFrIiwiaW50ZXJhdG9yIiwiYXBwbHkiLCJyZWQiLCJnZXRBbmRTZXRGb3JQaXhlbCIsImdyZWVuIiwiYmx1ZSIsInBvcyIsInZhbCIsImVsZW1lbnQiLCJ0b1N0cmluZyIsIm1hdGNoIiwidG9Mb3dlckNhc2UiLCJjYW52YXNEdW1teSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImdldENvbnRleHQiLCJzY29wZXIiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0Esb0JBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELFNBQ0Esc0JBQUFHLGVBQUFDLElBQ0FELFVBQUFILE9BQ0EsQ0FDQSxJQUFBSyxFQUFBTCxJQUNBLFFBQUFNLEtBQUFELEdBQUEsaUJBQUFKLGdCQUFBRixHQUFBTyxHQUFBRCxFQUFBQyxJQVBBLENBU0NDLE9BQUEsV0FDRCxtQkNUQSxJQUFBQyxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVCxRQUdB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Wm5GLEVBL2NBLEdBMGVBLFNBQUF5QixFQUEwQkosRUFBZUUsRUFBZ0JNLEdBQ3JELElBQUkwRCxFQUFjQyxTQUFTQyxjQUFjLFVBRXpDRixFQUFZbEUsTUFBUUEsRUFDcEJrRSxFQUFZaEUsT0FBU0EsRUFFckIsSUFBSUMsRUFBVStELEVBQVlHLFdBQVcsTUFFakNDLEdBQ0EzRCxPQUFRdUQsRUFDUi9ELFFBQVNBLEdBT2IsT0FKSUssR0FDQUEsRUFBUytDLE1BQU1lLEdBQVNuRSxFQUFTK0QsSUFHOUJJIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSB7XG5cdFx0dmFyIGEgPSBmYWN0b3J5KCk7XG5cdFx0Zm9yKHZhciBpIGluIGEpICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO1xuXHR9XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgZW51bSBUeXBlUmVhZGVyIHtcbiAgICBUT1AgPSAnVE9QJyxcbiAgICBSSUdIVCA9ICdSSUdIVCcsXG4gICAgQk9UVE9NID0gJ0JPVFRPTScsXG4gICAgTEVGVCA9ICdMRUZUJ1xufVxuIiwiaW1wb3J0IHsgVHlwZVJlYWRlciB9IGZyb20gJy4vY29uc3RhbnRzL3R5cGUtcmVhZGVyJztcblxuLyoqXG4gKiBAZXhwb3J0XG4gKiBAY2xhc3MgVHJpbUltYWdlXG4gKi9cbmV4cG9ydCBjbGFzcyBUcmltSW1hZ2Uge1xuICAgIHByaXZhdGUgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQ7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFRyaW1JbWFnZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7SFRNTEltYWdlRWxlbWVudH0gaW1hZ2UgSW1hZ2VuIGEgcHJvY2VzYXJcbiAgICAgKiBAcGFyYW0ge2FueX0gZnVuY0xvYWRCYWNrIEZ1bmNpw7NuIGJhY2sgcGFyYSBlbCBsb2FkIGRlIGxhIGltYWdlblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LCBmdW5jTG9hZEJhY2spIHtcbiAgICAgICAgdGhpcy5jb25maWd1cmVJbWFnZShpbWFnZSwgZnVuY0xvYWRCYWNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBDb25maWd1cmEgZWwgcGFyYW1ldHJvIGRlIGVudHJhZGEgXCJpbWFnZVwiIGRlbCBjb25zdHJ1Y3RvclxuICAgICAqXG4gICAgICogQHBhcmFtIHtbaW1hZ2Ugb2JqZWN0LCBTdHJpbmddfSBpbWFnZSAtIEltYWdlbiBhIHRyYXRhclxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIC0gRnVuY2lvbiBjYWxsYmFja1xuICAgICAqXG4gICAgICogQHJldHVybiB7aW1hZ2VEYXRhIG9iamVjdH1cbiAgICAgKi9cbiAgICBhc3luYyBjb25maWd1cmVJbWFnZShpbWFnZTogc3RyaW5nIHwgSFRNTEltYWdlRWxlbWVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5pbWFnZSA9XG4gICAgICAgICAgICB0eXBlb2YgaW1hZ2UgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICAgICAgPyBhd2FpdCBjcmVhdGVJbWFnZShpbWFnZSlcbiAgICAgICAgICAgICAgICA6IDxIVE1MSW1hZ2VFbGVtZW50PmltYWdlO1xuXG4gICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIHRoaXMuaW1hZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gRGV2dWVsdmUgdW4gb2JqZXRvIGltYWdlRGF0YSBhIHBhcnRpciBkZSB1bmEgaW1hZ2VuIGRhZGFcbiAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnR9IGltYWdlXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBnZXRJbWFnZURhdGEoaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGltZ1dpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICAgIGxldCBpbWdIZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XG5cbiAgICAgICAgbGV0IGNvbnRleHQgPSBjcmVhdGVDYW52YXNCYWNrKGltZ1dpZHRoLCBpbWdIZWlnaHQpLmNvbnRleHQ7XG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KTtcblxuICAgICAgICByZXR1cm4gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgaW1nV2lkdGgsIGltZ0hlaWdodCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gQ29udmllcnRlIHVuIGltYWdlRGF0YSBvYmplY3QgYSB1biBpbWFnZSBvYmplY3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1hZ2VEYXRhfSBpbWFnZURhdGEgLSBPYmpldG8gY29uIG1hdHJpeiBkZSBkYXRvcyBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcmV0dXJuIHtIVE1MSW1hZ2VFbGVtZW50fVxuICAgICAqL1xuICAgIGdldEltYWdlKGltYWdlRGF0YSwgZnVuY0JhY2s/KSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVJbWFnZURhdGEoaW1hZ2VEYXRhKTtcblxuICAgICAgICBsZXQgaW1nV2lkdGggPSBpbWFnZURhdGEud2lkdGg7XG4gICAgICAgIGxldCBpbWdIZWlnaHQgPSBpbWFnZURhdGEuaGVpZ2h0O1xuXG4gICAgICAgIGxldCBjYW52YXNCYWNrID0gY3JlYXRlQ2FudmFzQmFjayhpbWdXaWR0aCwgaW1nSGVpZ2h0KTtcblxuICAgICAgICBsZXQgY29udGV4dCA9IGNhbnZhc0JhY2suY29udGV4dDtcbiAgICAgICAgbGV0IGNhbnZhcyA9IGNhbnZhc0JhY2suY2FudmFzO1xuXG4gICAgICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG5cbiAgICAgICAgbGV0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGltYWdlLndpZHRoID0gaW1nV2lkdGg7XG4gICAgICAgIGltYWdlLmhlaWdodCA9IGltZ0hlaWdodDtcblxuICAgICAgICBpZiAoZnVuY0JhY2spIHtcbiAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9IGZ1bmNCYWNrO1xuICAgICAgICB9XG5cbiAgICAgICAgaW1hZ2Uuc3JjID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7XG5cbiAgICAgICAgcmV0dXJuIGltYWdlO1xuICAgIH1cblxuICAgIHN0YXRpYyB0cmltKGltYWdlPywgY2FsbGJhY2s/KSB7XG4gICAgICAgIHJldHVybiBuZXcgVHJpbUltYWdlKGltYWdlLCBjYWxsYmFjaykudHJpbSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBpbm5lY2VzYXJpb3MgcGFyYSB0b2RvcyBsb3MgYm9yZGVzIGRlIGxhIGltYWdlblxuICAgICAqIEBwYXJhbSBbaW1hZ2Ugb2JqZWN0XSBpbWFnZSAtIFBhcmFtZXRybyBvcGNpb25hbCB0aXBvIEltYWdlXG4gICAgICogQHJldHVybiBbaW1hZ2Ugb2JqZWN0LCB0aGlzXSAtIFJldG9ybmEgdGhpcyBzaSBlbCBwYXJhbWV0cm8gZXMgaW5kZWZpbmlkb1xuICAgICAqL1xuICAgIHRyaW0oaW1hZ2U/KSB7XG4gICAgICAgIGlmIChpbWFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbWFnZSh0aGlzLl90cmltKHRoaXMuZ2V0SW1hZ2VEYXRhKGltYWdlKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UodGhpcy5fdHJpbSh0aGlzLmdldEltYWdlRGF0YSh0aGlzLmltYWdlKSkpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBpbm5lY2VzYXJpb3MgcGFyYSBlbCBib3JkZSBzdXBlcmlvciBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcGFyYW0gW2ltYWdlIG9iamVjdF0gaW1hZ2UgLSBQYXJhbWV0cm8gb3BjaW9uYWwgdGlwbyBJbWFnZVxuICAgICAqIEByZXR1cm4gW2ltYWdlIG9iamVjdCwgdGhpc10gLSBSZXRvcm5hIHRoaXMgc2kgZWwgcGFyYW1ldHJvIGVzIGluZGVmaW5pZG9cbiAgICAgKi9cbiAgICB0cmltVG9wKGltYWdlKSB7XG4gICAgICAgIGlmIChpbWFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbWFnZSh0aGlzLl90cmltVG9wKHRoaXMuZ2V0SW1hZ2VEYXRhKGltYWdlKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLl90cmltVG9wKHRoaXMuZ2V0SW1hZ2VEYXRhKHRoaXMuaW1hZ2UpKVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBpbm5lY2VzYXJpb3MgcGFyYSBlbCBib3JkZSBpbmZlcmlvciBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcGFyYW0gW2ltYWdlIG9iamVjdF0gaW1hZ2UgLSBQYXJhbWV0cm8gb3BjaW9uYWwgdGlwbyBJbWFnZVxuICAgICAqIEByZXR1cm4gW2ltYWdlIG9iamVjdCwgdGhpc10gLSBSZXRvcm5hIHRoaXMgc2kgZWwgcGFyYW1ldHJvIGVzIGluZGVmaW5pZG9cbiAgICAgKi9cbiAgICB0cmltQm90dG9tKGltYWdlKSB7XG4gICAgICAgIGlmIChpbWFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbWFnZSh0aGlzLl90cmltQm90dG9tKHRoaXMuZ2V0SW1hZ2VEYXRhKGltYWdlKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLl90cmltQm90dG9tKHRoaXMuZ2V0SW1hZ2VEYXRhKHRoaXMuaW1hZ2UpKVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBpbm5lY2VzYXJpb3MgcGFyYSBlbCBib3JkZSBpenF1aWVyZG8gZGUgbGEgaW1hZ2VuXG4gICAgICogQHBhcmFtIFtpbWFnZSBvYmplY3RdIGltYWdlIC0gUGFyYW1ldHJvIG9wY2lvbmFsIHRpcG8gSW1hZ2VcbiAgICAgKiBAcmV0dXJuIFtpbWFnZSBvYmplY3QsIHRoaXNdIC0gUmV0b3JuYSB0aGlzIHNpIGVsIHBhcmFtZXRybyBlcyBpbmRlZmluaWRvXG4gICAgICovXG4gICAgdHJpbUxlZnQoaW1hZ2UpIHtcbiAgICAgICAgaWYgKGltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEltYWdlKHRoaXMuX3RyaW1MZWZ0KHRoaXMuZ2V0SW1hZ2VEYXRhKGltYWdlKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLl90cmltTGVmdCh0aGlzLmdldEltYWdlRGF0YSh0aGlzLmltYWdlKSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBFbGltaW5hIHBpeGVsZXMgaW5uZWNlc2FyaW9zIHBhcmEgZWwgYm9yZGUgZGVyZWNobyBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcGFyYW0gW2ltYWdlIG9iamVjdF0gaW1hZ2UgLSBQYXJhbWV0cm8gb3BjaW9uYWwgdGlwbyBJbWFnZVxuICAgICAqIEByZXR1cm4gW2ltYWdlIG9iamVjdCwgdGhpc10gLSBSZXRvcm5hIHRoaXMgc2kgZWwgcGFyYW1ldHJvIGVzIGluZGVmaW5pZG9cbiAgICAgKi9cbiAgICB0cmltUmlnaHQoaW1hZ2UpIHtcbiAgICAgICAgaWYgKGltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEltYWdlKHRoaXMuX3RyaW1SaWdodCh0aGlzLmdldEltYWdlRGF0YShpbWFnZSkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLmdldEltYWdlKFxuICAgICAgICAgICAgdGhpcy5fdHJpbVJpZ2h0KHRoaXMuZ2V0SW1hZ2VEYXRhKHRoaXMuaW1hZ2UpKVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIEVsaW1pbmEgcGl4ZWxlcyBkZSBsYSBpbWFnZW4gaW5uZWNlc2FyaW9zXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltYWdlRGF0YX0gaW1hZ2VEYXRhIC0gRGF0b3MgZGUgbGEgaW1hZ2VuIGVuIGZvcm1hIGRlIG1hdHJpelxuICAgICAqIEByZXR1cm4ge2ltYWdlRGF0YSBvYmplY3R9XG4gICAgICovXG4gICAgcHJpdmF0ZSBfdHJpbShpbWFnZURhdGEpIHtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUltYWdlRGF0YShpbWFnZURhdGEpO1xuXG4gICAgICAgIGxldCB0cmltbWVkSW1hZ2UgPSB0aGlzLl90cmltVG9wKGltYWdlRGF0YSk7XG4gICAgICAgIHRyaW1tZWRJbWFnZSA9IHRoaXMuX3RyaW1Cb3R0b20odHJpbW1lZEltYWdlKTtcbiAgICAgICAgdHJpbW1lZEltYWdlID0gdGhpcy5fdHJpbUxlZnQodHJpbW1lZEltYWdlKTtcbiAgICAgICAgdHJpbW1lZEltYWdlID0gdGhpcy5fdHJpbVJpZ2h0KHRyaW1tZWRJbWFnZSk7XG5cbiAgICAgICAgcmV0dXJuIHRyaW1tZWRJbWFnZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVzY3JpcHRpb24gLSBEZXZ1ZWx2ZSB1biBhcnJheSBkZSBkYXRvcyBkZSBsYSBpbWFnZW5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1hZ2VEYXRhfSBpbWFnZURhdGEgLSBNYXRyaXogZGUgZGF0b3MgZGUgbGEgaW1hZ2VuXG4gICAgICogQHJldHVybiB7aW1hZ2VEYXRhIG9iamVjdH1cbiAgICAgKi9cbiAgICBwcml2YXRlIF90cmltVG9wKGltYWdlRGF0YSkge1xuICAgICAgICBsZXQgcm93ID0gMDtcbiAgICAgICAgbGV0IGxlbmdodENvbCA9IGltYWdlRGF0YS53aWR0aCAqIDQ7XG4gICAgICAgIGxldCBsZW5naHRSb3cgPSBpbWFnZURhdGEuaGVpZ2h0O1xuXG4gICAgICAgIHRoaXMucmVhZEltYWdlRGF0YShUeXBlUmVhZGVyLlRPUCwgaW1hZ2VEYXRhLCBmdW5jdGlvbihyLCBjKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hbHBoYSgpICE9IDApIHtcbiAgICAgICAgICAgICAgICByb3cgPSByO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICdicmVhayc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmN1dEltYWdlRGF0YShpbWFnZURhdGEsIHJvdywgMCwgbGVuZ2h0Um93LCBsZW5naHRDb2wpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIERldnVlbHZlIHVuIGFycmF5IGRlIGRhdG9zIGRlIGxhIGltYWdlblxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbWFnZURhdGF9IGltYWdlRGF0YSAtIE1hdHJpeiBkZSBkYXRvcyBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcmV0dXJuIHtpbWFnZURhdGEgb2JqZWN0fVxuICAgICAqL1xuICAgIHByaXZhdGUgX3RyaW1Cb3R0b20oaW1hZ2VEYXRhKSB7XG4gICAgICAgIGxldCBsZW5naHRSb3cgPSBpbWFnZURhdGEuaGVpZ2h0O1xuICAgICAgICBsZXQgbGVuZ2h0Q29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcblxuICAgICAgICB0aGlzLnJlYWRJbWFnZURhdGEoVHlwZVJlYWRlci5CT1RUT00sIGltYWdlRGF0YSwgZnVuY3Rpb24ociwgYykge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWxwaGEoKSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgbGVuZ2h0Um93ID0gcjtcblxuICAgICAgICAgICAgICAgIHJldHVybiAnYnJlYWsnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5jdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwLCBsZW5naHRSb3csIGxlbmdodENvbCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlc2NyaXB0aW9uIC0gRGV2dWVsdmUgdW4gYXJyYXkgZGUgZGF0b3MgZGUgbGEgaW1hZ2VuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltYWdlRGF0YX0gaW1hZ2VEYXRhIC0gTWF0cml6IGRlIGRhdG9zIGRlIGxhIGltYWdlblxuICAgICAqIEByZXR1cm4ge2ltYWdlRGF0YSBvYmplY3R9XG4gICAgICovXG4gICAgcHJpdmF0ZSBfdHJpbUxlZnQoaW1hZ2VEYXRhKSB7XG4gICAgICAgIGxldCBjb2wgPSAwO1xuICAgICAgICBsZXQgbGVuZ2h0Q29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcbiAgICAgICAgbGV0IGxlbmdodFJvdyA9IGltYWdlRGF0YS5oZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5yZWFkSW1hZ2VEYXRhKFR5cGVSZWFkZXIuTEVGVCwgaW1hZ2VEYXRhLCBmdW5jdGlvbihyLCBjKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hbHBoYSgpICE9IDApIHtcbiAgICAgICAgICAgICAgICBjb2wgPSBjO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICdicmVhayc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmN1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIGNvbCwgbGVuZ2h0Um93LCBsZW5naHRDb2wpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXNjcmlwdGlvbiAtIERldnVlbHZlIHVuIGFycmF5IGRlIGRhdG9zIGRlIGxhIGltYWdlblxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbWFnZURhdGF9IGltYWdlRGF0YSAtIE1hdHJpeiBkZSBkYXRvcyBkZSBsYSBpbWFnZW5cbiAgICAgKiBAcmV0dXJuIHtpbWFnZURhdGEgb2JqZWN0fVxuICAgICAqL1xuICAgIHByaXZhdGUgX3RyaW1SaWdodChpbWFnZURhdGEpIHtcbiAgICAgICAgbGV0IGxlbl9jb2wgPSBpbWFnZURhdGEud2lkdGggKiA0O1xuICAgICAgICBsZXQgbGVuX3JvdyA9IGltYWdlRGF0YS5oZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5yZWFkSW1hZ2VEYXRhKFR5cGVSZWFkZXIuUklHSFQsIGltYWdlRGF0YSwgZnVuY3Rpb24ociwgYykge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWxwaGEoKSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgbGVuX2NvbCA9IGM7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJ2JyZWFrJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3V0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCwgbGVuX3JvdywgbGVuX2NvbCk7XG4gICAgfVxuXG4gICAgY3V0SW1hZ2VEYXRhKGltYWdlRGF0YSwgcm93SW5pLCBjb2xJbmksIHJvd0ZpbiwgY29sRmluKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVJbWFnZURhdGEoaW1hZ2VEYXRhKTtcblxuICAgICAgICBsZXQgcGl4ZWxzID0gaW1hZ2VEYXRhLmRhdGE7XG4gICAgICAgIGxldCBsZW5fY29sID0gaW1hZ2VEYXRhLndpZHRoICogNDtcblxuICAgICAgICByb3dGaW4gPSByb3dGaW4gPT0gMCA/IDEgOiByb3dGaW47XG4gICAgICAgIGNvbEZpbiA9IGNvbEZpbiA9PSAwID8gMSA6IGNvbEZpbjtcblxuICAgICAgICBsZXQgY29weUhlaWdodCA9IHJvd0ZpbiA9PSByb3dJbmkgPyAxIDogcm93RmluIC0gcm93SW5pLFxuICAgICAgICAgICAgY29weVdpZHRoID0gY29sRmluIC8gNCAtIGNvbEluaSAvIDQ7XG5cbiAgICAgICAgbGV0IGNvcHlJbWFnZURhdGE6IGFueSA9IFtdO1xuXG4gICAgICAgIGNyZWF0ZUNhbnZhc0JhY2soY29weVdpZHRoLCBjb3B5SGVpZ2h0LCBmdW5jdGlvbihjdHgpIHtcbiAgICAgICAgICAgIGNvcHlJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKGNvcHlXaWR0aCwgY29weUhlaWdodCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBkaWZmQ29sID0gbGVuX2NvbCAtIGNvbEZpbjtcbiAgICAgICAgbGV0IGNvdW50Q29weSA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgcm93ID0gcm93SW5pOyByb3cgPCByb3dGaW47IHJvdysrKSB7XG4gICAgICAgICAgICBsZXQgcm93Q3VycmVudCA9IHJvdyAqIGNvbEZpbiArIHJvdyAqIGRpZmZDb2w7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGNvbCA9IGNvbEluaTsgY29sIDwgY29sRmluOyBjb2wgKz0gNCwgY291bnRDb3B5ICs9IDQpIHtcbiAgICAgICAgICAgICAgICBjb3B5SW1hZ2VEYXRhLmRhdGFbY291bnRDb3B5XSA9IHBpeGVsc1tyb3dDdXJyZW50ICsgY29sXTtcbiAgICAgICAgICAgICAgICBjb3B5SW1hZ2VEYXRhLmRhdGFbY291bnRDb3B5ICsgMV0gPVxuICAgICAgICAgICAgICAgICAgICBwaXhlbHNbcm93Q3VycmVudCArIGNvbCArIDFdO1xuICAgICAgICAgICAgICAgIGNvcHlJbWFnZURhdGEuZGF0YVtjb3VudENvcHkgKyAyXSA9XG4gICAgICAgICAgICAgICAgICAgIHBpeGVsc1tyb3dDdXJyZW50ICsgY29sICsgMl07XG4gICAgICAgICAgICAgICAgY29weUltYWdlRGF0YS5kYXRhW2NvdW50Q29weSArIDNdID1cbiAgICAgICAgICAgICAgICAgICAgcGl4ZWxzW3Jvd0N1cnJlbnQgKyBjb2wgKyAzXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb3B5SW1hZ2VEYXRhO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVhZEltYWdlRGF0YSh0eXBlUmVhZGVyOiBUeXBlUmVhZGVyLCBpbWFnZURhdGEsIGZ1bmNCYWNrKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVJbWFnZURhdGEoaW1hZ2VEYXRhKTtcblxuICAgICAgICBsZXQgcGl4ZWxzID0gaW1hZ2VEYXRhLmRhdGE7XG4gICAgICAgIGxldCByb3c7XG4gICAgICAgIGxldCBjb2w7XG4gICAgICAgIGxldCByb3dDdXJyZW50ID0gLTE7XG5cbiAgICAgICAgbGV0IGxlbl9jb2wgPSBpbWFnZURhdGEud2lkdGggKiA0O1xuICAgICAgICBsZXQgbGVuX3JvdyA9IGltYWdlRGF0YS5oZWlnaHQ7XG5cbiAgICAgICAgbGV0IGlzQnJlYWs6IGFueSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0eXBlUmVhZGVyID09PSBUeXBlUmVhZGVyLlRPUCkge1xuICAgICAgICAgICAgbGV0IHJvd0luaSA9IDA7XG4gICAgICAgICAgICBsZXQgcm93RmluID0gbGVuX3JvdztcbiAgICAgICAgICAgIGxldCBjb2xJbmkgPSAwO1xuICAgICAgICAgICAgbGV0IGNvbEZpbiA9IGxlbl9jb2w7XG5cbiAgICAgICAgICAgIGxldCBpbnRlcmF0b3IgPSB7XG4gICAgICAgICAgICAgICAgcm93OiAxLFxuICAgICAgICAgICAgICAgIGNvbDogNFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yIChyb3cgPSByb3dJbmk7IHJvdyA8IHJvd0Zpbjsgcm93ICs9IGludGVyYXRvci5yb3cpIHtcbiAgICAgICAgICAgICAgICByb3dDdXJyZW50ID0gcm93ICogbGVuX2NvbDtcblxuICAgICAgICAgICAgICAgIGZvciAoY29sID0gY29sSW5pOyBjb2wgPCBjb2xGaW47IGNvbCArPSBpbnRlcmF0b3IuY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzQnJlYWsgPSBmdW5jQmFjay5hcHBseShcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWQ6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgKyBjb2wpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVuOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sICsgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ZTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sICsgMylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbcm93LCBjb2xdXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNCcmVhayA9PSAnYnJlYWsnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlUmVhZGVyID09PSBUeXBlUmVhZGVyLkJPVFRPTSkge1xuICAgICAgICAgICAgbGV0IHJvd0luaSA9IGxlbl9yb3c7XG4gICAgICAgICAgICBsZXQgcm93RmluID0gMDtcbiAgICAgICAgICAgIGxldCBjb2xJbmkgPSBsZW5fY29sO1xuICAgICAgICAgICAgbGV0IGNvbEZpbiA9IDA7XG5cbiAgICAgICAgICAgIGZvciAocm93ID0gcm93SW5pOyByb3cgPj0gcm93RmluOyByb3ctLSkge1xuICAgICAgICAgICAgICAgIHJvd0N1cnJlbnQgPSByb3cgKiBjb2xJbmk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IGNvbEluaTsgY29sID4gY29sRmluOyBjb2wgLT0gNCkge1xuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrID0gZnVuY0JhY2suYXBwbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50IC0gY29sKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbjogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIGNvbCAtIDMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdWU6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgLSBjb2wgLSAyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIGNvbCAtIDEpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgW3JvdywgY29sXVxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0JyZWFrID09ICdicmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZVJlYWRlciA9PT0gVHlwZVJlYWRlci5MRUZUKSB7XG4gICAgICAgICAgICBsZXQgcm93SW5pID0gMDtcbiAgICAgICAgICAgIGxldCByb3dGaW4gPSBsZW5fcm93O1xuICAgICAgICAgICAgbGV0IGNvbEluaSA9IDA7XG4gICAgICAgICAgICBsZXQgY29sRmluID0gbGVuX2NvbDtcblxuICAgICAgICAgICAgZm9yIChjb2wgPSBjb2xJbmk7IGNvbCA8IGNvbEZpbjsgY29sICs9IDQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IHJvd0luaTsgcm93IDwgcm93RmluOyByb3crKykge1xuICAgICAgICAgICAgICAgICAgICByb3dDdXJyZW50ID0gcm93ICogY29sRmluO1xuXG4gICAgICAgICAgICAgICAgICAgIGlzQnJlYWsgPSBmdW5jQmFjay5hcHBseShcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWQ6IGdldEFuZFNldEZvclBpeGVsKHJvd0N1cnJlbnQgKyBjb2wpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVuOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sICsgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ZTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCArIGNvbCArIDIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50ICsgY29sICsgMylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbcm93LCBjb2xdXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQnJlYWsgPT0gJ2JyZWFrJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNCcmVhayA9PSAnYnJlYWsnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlUmVhZGVyID09PSBUeXBlUmVhZGVyLlJJR0hUKSB7XG4gICAgICAgICAgICBsZXQgcm93SW5pID0gbGVuX3JvdyAtIDE7XG4gICAgICAgICAgICBsZXQgcm93RmluID0gMTtcbiAgICAgICAgICAgIGxldCBjb2xJbmkgPSBsZW5fY29sO1xuICAgICAgICAgICAgbGV0IGNvbEZpbiA9IDA7XG5cbiAgICAgICAgICAgIGZvciAoY29sID0gY29sSW5pOyBjb2wgPiBjb2xGaW47IGNvbCAtPSA0KSB7XG4gICAgICAgICAgICAgICAgZm9yIChyb3cgPSByb3dJbmk7IHJvdyA+IHJvd0Zpbjsgcm93LS0pIHtcbiAgICAgICAgICAgICAgICAgICAgcm93Q3VycmVudCA9IHJvdyAqIGNvbEluaSAtIDQgKyBjb2w7XG5cbiAgICAgICAgICAgICAgICAgICAgaXNCcmVhayA9IGZ1bmNCYWNrLmFwcGx5KFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZDogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIDMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVuOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50IC0gMiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ZTogZ2V0QW5kU2V0Rm9yUGl4ZWwocm93Q3VycmVudCAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiBnZXRBbmRTZXRGb3JQaXhlbChyb3dDdXJyZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtyb3csIGNvbF1cbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNCcmVhayA9PSAnYnJlYWsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0JyZWFrID09ICdicmVhaycpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QW5kU2V0Rm9yUGl4ZWwocG9zKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBpeGVsc1twb3NdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBpeGVsc1twb3NdID0gdmFsO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbWFnZURhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGltYWdlRGF0YVxuICAgICAqL1xuICAgIHByaXZhdGUgdmFsaWRhdGVJbWFnZURhdGEoaW1hZ2VEYXRhKSB7XG4gICAgICAgIGlmIChpcyhpbWFnZURhdGEpICE9PSAnaW1hZ2VkYXRhJylcbiAgICAgICAgICAgIHRocm93ICdJbWFnZURhdGEgRXhjZXB0aW9uOiBObyBlcyBjb21wYXRpYmxlIGVsIHRpcG8gZGUgZGF0byc7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpcyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nXG4gICAgICAgIC5jYWxsKGVsZW1lbnQpXG4gICAgICAgIC5tYXRjaCgvXFxzKFthLXp8QS1aXSspLylbMV1cbiAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHNyY1xuICogQHJldHVybnMge1Byb21pc2U8SFRNTEltYWdlRWxlbWVudD59XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUltYWdlKHNyYzogc3RyaW5nKTogUHJvbWlzZTxIVE1MSW1hZ2VFbGVtZW50PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpOyAgICAgICBcbiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHJlc29sdmUoaW1nKTtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSByZWplY3Q7XG4gICAgICAgIGltZy5zcmMgPSBzcmM7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHdpZHRoXG4gKiBAcGFyYW0gaGVpZ2h0XG4gKiBAcGFyYW0gZnVuY0JhY2tcbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ2FudmFzQmFjayh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZnVuY0JhY2s/KSB7XG4gICAgbGV0IGNhbnZhc0R1bW15ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG5cbiAgICBjYW52YXNEdW1teS53aWR0aCA9IHdpZHRoO1xuICAgIGNhbnZhc0R1bW15LmhlaWdodCA9IGhlaWdodDtcblxuICAgIGxldCBjb250ZXh0ID0gY2FudmFzRHVtbXkuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgIGxldCBzY29wZXIgPSB7XG4gICAgICAgIGNhbnZhczogY2FudmFzRHVtbXksXG4gICAgICAgIGNvbnRleHQ6IGNvbnRleHRcbiAgICB9O1xuXG4gICAgaWYgKGZ1bmNCYWNrKSB7XG4gICAgICAgIGZ1bmNCYWNrLmFwcGx5KHNjb3BlciwgW2NvbnRleHQsIGNhbnZhc0R1bW15XSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNjb3Blcjtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=